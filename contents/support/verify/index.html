<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../../resources/styles/main.css" rel="stylesheet">
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>
<body>
<div class="container">
    <div class="main text-center">
        <img src="../../../resources/images/icon.png" width="130" height="130"/>

        <div>
            <h1>Cabbit<br>
                <small>당신을 위한 저렴하고<br>안전한 택시합승 서비스</small>
            </h1>
            <br>

            <div id="info" class="alert alert-info" role="alert">인증이 진행중입니다. 잠시만 기다려 주세요...</div>
            <div id="success" class="alert alert-success hidden" role="alert">인증이 완료되었습니다! 앱에서 다시 로그인해 주세요!</div>
            <div id="fail" class="alert alert-danger hidden" role="alert">서버 문제로 인해 인증에 실패하였습니다. 캐빗팀에 연락해 주세요 ㅜㅜ</div>
            <div id="warn" class="alert alert-warning hidden" role="alert">인증한지 너무 오래되었거나 요청이 잘못 되었습니다. 다시 이메일을 요청해
                주세요!
            </div>
        </div>
    </div>
</div>
<script>
    function getURLParameter(name) {
        var ret = null;
        var nowAddress = unescape(window.location.href);
        var parameters = (nowAddress.slice(nowAddress.indexOf("?") + 1, nowAddress.length)).split("&");
        for (var i = 0; i < parameters.length; i++) {
            var varName = parameters[i].split("=")[0];
            if (varName.toUpperCase() === name.toUpperCase()) {
                ret = parameters[i].split("=")[1];
                break;
            }
        }
        return ret;
    }

    function verify() {
        var host = 'https://api.pooling.com';
        if ('remote' === getURLParameter('dev')) {
            host = 'https://test.yimocall.com/pooling';
        } else if ('local' === getURLParameter('dev')) {
            host = 'http://localhost:8100';
        }
        var authToken = getURLParameter('auth_token');
        $.ajax({
                    url: host + '/EmailAuth/verify',
                    type: 'PUT',
                    dataType: 'json',
                    headers: {
                        'Authorization': 'Bearer ' + getURLParameter('access_token'),
                        'Content-Type': "application/json; charset=utf8"
                    },
                    data: JSON.stringify({
                        authToken: authToken
                    })
                })
                .done(function (data) {
                    $("#info").addClass("hidden");
                    $("#success").removeClass("hidden");
                })
                .fail(function (err) {
                    $("#info").addClass("hidden");
                    if (500 > err.status) {
                        $("#warn").removeClass("hidden");
                    } else {
                        $("#fail").removeClass("hidden");
                    }
                });
    }
    verify();
</script>

</body>
</html>